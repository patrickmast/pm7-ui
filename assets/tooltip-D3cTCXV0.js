var w=Object.defineProperty;var v=(n,t,e)=>t in n?w(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var p=(n,t,e)=>v(n,typeof t!="symbol"?t+"":t,e);const o=class o{constructor(t){var i,s;const e=t.hasAttribute("data-pm7-tooltip-initialized"),r=o.instances.has(t);if(e&&!r&&(console.log("[PM7Tooltip] Self-healing: Re-initializing tooltip after framework re-render"),t.removeAttribute("data-pm7-tooltip-initialized")),o.instances.has(t))return o.instances.get(t);this.element=t,this.element.classList.contains("pm7-tooltip")||this.element.classList.add("pm7-tooltip"),this.trigger=t.querySelector(".pm7-tooltip-trigger"),this.content=t.querySelector(".pm7-tooltip-content"),this.arrow=t.querySelector(".pm7-tooltip-arrow"),this.side=((i=this.content)==null?void 0:i.dataset.side)||"top",this.align=((s=this.content)==null?void 0:s.dataset.align)||"center",this.delay=parseInt(t.dataset.delay||"0"),this.openDelay=parseInt(t.dataset.openDelay||this.delay||"0"),this.closeDelay=parseInt(t.dataset.closeDelay||"0"),this.isOpen=!1,this.openTimeout=null,this.closeTimeout=null,this.eventListeners=new Map;const l=this.preserveState();o.instances.set(t,this),t._pm7TooltipInstance=this,this.handleTriggerMouseEnter=this.handleTriggerMouseEnter.bind(this),this.handleTriggerMouseLeave=this.handleTriggerMouseLeave.bind(this),this.handleTriggerFocus=this.handleTriggerFocus.bind(this),this.handleTriggerBlur=this.handleTriggerBlur.bind(this),this.handleTriggerClick=this.handleTriggerClick.bind(this),this.handleDocumentClick=this.handleDocumentClick.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.updatePosition=this.updatePosition.bind(this),this.init(),l&&l.wasOpen&&this.restoreState(l),t.setAttribute("data-pm7-tooltip-initialized","true")}preserveState(){const t=this.element.querySelector(".pm7-tooltip-content");return{wasOpen:(t==null?void 0:t.getAttribute("data-state"))==="open",side:t==null?void 0:t.dataset.side,align:t==null?void 0:t.dataset.align}}restoreState(t){t.wasOpen&&setTimeout(()=>{this.show()},50)}cleanup(){this.eventListeners.forEach(({element:t,type:e,handler:r})=>{t.removeEventListener(e,r)}),this.eventListeners.clear(),this.clearTimeouts()}init(){!this.trigger||!this.content||(this.cleanup(),this.trigger.setAttribute("aria-describedby",this.content.id||this.generateId()),this.content.setAttribute("role","tooltip"),this.content.setAttribute("data-state","closed"),this.trigger.addEventListener("mouseenter",this.handleTriggerMouseEnter),this.eventListeners.set("mouseenter",{element:this.trigger,type:"mouseenter",handler:this.handleTriggerMouseEnter}),this.trigger.addEventListener("mouseleave",this.handleTriggerMouseLeave),this.eventListeners.set("mouseleave",{element:this.trigger,type:"mouseleave",handler:this.handleTriggerMouseLeave}),this.trigger.addEventListener("focus",this.handleTriggerFocus),this.eventListeners.set("focus",{element:this.trigger,type:"focus",handler:this.handleTriggerFocus}),this.trigger.addEventListener("blur",this.handleTriggerBlur),this.eventListeners.set("blur",{element:this.trigger,type:"blur",handler:this.handleTriggerBlur}),"ontouchstart"in window&&(this.trigger.addEventListener("click",this.handleTriggerClick),this.eventListeners.set("click",{element:this.trigger,type:"click",handler:this.handleTriggerClick})))}handleTriggerMouseEnter(){this.clearTimeouts(),this.openDelay>0?this.openTimeout=setTimeout(()=>{this.show()},this.openDelay):this.show()}handleTriggerMouseLeave(){this.clearTimeouts(),this.closeDelay>0?this.closeTimeout=setTimeout(()=>{this.hide()},this.closeDelay):this.hide()}handleTriggerFocus(){this.show()}handleTriggerBlur(){this.hide()}handleTriggerClick(t){t.preventDefault(),t.stopPropagation(),this.isOpen?this.hide():(this.show(),setTimeout(()=>{document.addEventListener("click",this.handleDocumentClick)},0))}handleDocumentClick(t){this.element.contains(t.target)||(this.hide(),document.removeEventListener("click",this.handleDocumentClick))}handleKeyDown(t){t.key==="Escape"&&this.isOpen&&(this.hide(),this.trigger.focus())}show(){this.isOpen||(this.isOpen=!0,this.content.setAttribute("data-state","open"),this.updatePosition(),document.addEventListener("keydown",this.handleKeyDown),window.addEventListener("scroll",this.updatePosition,!0),window.addEventListener("resize",this.updatePosition),this.announceToScreenReaders(),this.element.dispatchEvent(new CustomEvent("pm7:tooltip:show",{bubbles:!0,detail:{tooltip:this}})))}hide(){this.isOpen&&(this.isOpen=!1,this.content.setAttribute("data-state","closed"),document.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("scroll",this.updatePosition,!0),window.removeEventListener("resize",this.updatePosition),this.element.dispatchEvent(new CustomEvent("pm7:tooltip:hide",{bubbles:!0,detail:{tooltip:this}})))}updatePosition(){if(!this.trigger||!this.content)return;this.content.style.top="",this.content.style.left="",this.content.style.right="",this.content.style.bottom="";const t=this.trigger.getBoundingClientRect(),e=this.content.getBoundingClientRect(),r=window.innerWidth,l=window.innerHeight;let i=this.side;const s=8,c=8;i==="top"&&t.top-e.height-s<0?i="bottom":i==="bottom"&&t.bottom+e.height+s>l?i="top":i==="left"&&t.left-e.width-s<0?i="right":i==="right"&&t.right+e.width+s>r&&(i="left"),this.content.setAttribute("data-side",i);let h,a;switch(i){case"top":h=t.top-e.height-c,a=t.left+(t.width-e.width)/2;break;case"bottom":h=t.bottom+c,a=t.left+(t.width-e.width)/2;break;case"left":h=t.top+(t.height-e.height)/2,a=t.left-e.width-c;break;case"right":h=t.top+(t.height-e.height)/2,a=t.right+c;break}if(h=Math.max(s,Math.min(h,l-e.height-s)),a=Math.max(s,Math.min(a,r-e.width-s)),this.content.style.top=`${h}px`,this.content.style.left=`${a}px`,(i==="top"||i==="bottom")&&this.align==="center"){const u=e.width/2,g=t.left+t.width/2;g-u<s?this.content.setAttribute("data-align","start"):g+u>r-s&&this.content.setAttribute("data-align","end")}}clearTimeouts(){this.openTimeout&&(clearTimeout(this.openTimeout),this.openTimeout=null),this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)}generateId(){return`pm7-tooltip-${Math.random().toString(36).substr(2,9)}`}announceToScreenReaders(){const t=document.createElement("div");t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.className="pm7-sr-only",t.textContent=this.content.textContent,document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},1e3)}destroy(){this.cleanup(),o.instances.delete(this.element),delete this.element._pm7TooltipInstance,document.removeEventListener("click",this.handleDocumentClick),document.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("scroll",this.updatePosition,!0),window.removeEventListener("resize",this.updatePosition),this.hide()}};p(o,"instances",new WeakMap);let d=o;function f(){document.querySelectorAll("[data-pm7-tooltip][data-pm7-tooltip-initialized]:not([data-pm7-tooltip-healing])").forEach(t=>{(!t._pm7TooltipInstance||!d.instances.has(t))&&(t.setAttribute("data-pm7-tooltip-healing","true"),console.log("[PM7Tooltip] Healing tooltip:",t),new d(t),t.removeAttribute("data-pm7-tooltip-healing"))})}function m(n=document){n.querySelectorAll("[data-pm7-tooltip]:not([data-pm7-tooltip-initialized])").forEach(e=>{!e.classList.contains("pm7-tooltip-trigger")&&!e.classList.contains("pm7-tooltip-content")&&new d(e)})}d.heal=f;typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>m()):m());export{d as P,m as i};
