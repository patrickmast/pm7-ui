var l=Object.defineProperty;var h=(u,e,t)=>e in u?l(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t;var m=(u,e,t)=>h(u,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const c=class c{constructor(e){const t=e.hasAttribute("data-pm7-menu-initialized"),i=c.instances.has(e);if(t&&!i&&(console.log("[PM7Menu] Self-healing: Re-initializing menu after framework re-render"),e.removeAttribute("data-pm7-menu-initialized")),c.instances.has(e))return c.instances.get(e);this.element=e;const n=this.preserveState();this.element.classList.contains("pm7-menu")||this.element.classList.add("pm7-menu"),this.trigger=e.querySelector(".pm7-menu-trigger"),this.content=e.querySelector(".pm7-menu-content"),this.items=e.querySelectorAll(".pm7-menu-item"),this.isOpen=!1,this.currentIndex=-1,this.hoverTimeouts=new Map,!(!this.trigger||!this.content)&&(c.instances.set(e,this),e._pm7MenuInstance=this,this.init(),n&&this.restoreState(n),e.setAttribute("data-pm7-menu-initialized","true"))}preserveState(){var t;const e=this.element.querySelector(".pm7-menu-content");return e?{wasOpen:e.classList.contains("pm7-menu-content--open")||e.getAttribute("data-state")==="open",triggerExpanded:((t=this.element.querySelector(".pm7-menu-trigger"))==null?void 0:t.getAttribute("aria-expanded"))==="true"}:null}restoreState(e){e.wasOpen&&setTimeout(()=>{this.open()},0)}init(){this.cleanup(),this.isInMenuBar=this.element.closest(".pm7-menu-bar")!==null,this.boundHandlers={triggerClick:e=>{e.stopPropagation(),this.isInMenuBar&&this.isAnyMenuBarMenuOpen()&&!this.isOpen?this.open():this.toggle()},triggerMouseEnter:()=>{this.isAnyMenuBarMenuOpen()&&this.open()},outsideClick:e=>{if(!this.element.contains(e.target)&&this.isOpen){const t=e.target.closest(".pm7-submenu");(!t||!this.element.contains(t))&&this.close()}},escape:e=>{e.key==="Escape"&&this.isOpen&&(e.stopPropagation(),this.close(),this.trigger.focus())},reposition:()=>{this.isOpen&&this.adjustPosition()}},this.trigger.addEventListener("click",this.boundHandlers.triggerClick),this.isInMenuBar&&this.trigger.addEventListener("mouseenter",this.boundHandlers.triggerMouseEnter),this.initSubmenuHoverHandling(),document.addEventListener("click",this.boundHandlers.outsideClick),this.trigger.addEventListener("keydown",e=>this.handleTriggerKeyDown(e)),this.content.addEventListener("keydown",e=>this.handleMenuKeyDown(e)),this.items.forEach((e,t)=>{e.addEventListener("mousedown",i=>{!e.disabled&&!e.hasAttribute("disabled")&&!e.classList.contains("pm7-menu-item--has-submenu")&&(e.classList.add("pm7-menu-item--clicking"),this._clickingItem=!0)}),e.addEventListener("click",i=>{!e.disabled&&!e.hasAttribute("disabled")&&this.handleItemClick(i,e),this._clickingItem=!1}),e.setAttribute("tabindex","-1")}),window.addEventListener("resize",this.boundHandlers.reposition),window.addEventListener("scroll",this.boundHandlers.reposition,!0)}cleanup(){var e,t;this.boundHandlers&&((e=this.trigger)==null||e.removeEventListener("click",this.boundHandlers.triggerClick),(t=this.trigger)==null||t.removeEventListener("mouseenter",this.boundHandlers.triggerMouseEnter),document.removeEventListener("click",this.boundHandlers.outsideClick),document.removeEventListener("keydown",this.boundHandlers.escape),window.removeEventListener("resize",this.boundHandlers.reposition),window.removeEventListener("scroll",this.boundHandlers.reposition,!0))}destroy(){this.cleanup(),this.close(),c.instances.delete(this.element),delete this.element._pm7MenuInstance}toggle(){this.isOpen?this.close():this.open()}open(){document.querySelectorAll(".pm7-menu-content--open").forEach(e=>{const t=e.closest("[data-pm7-menu]");t&&t._pm7MenuInstance&&t._pm7MenuInstance!==this&&t._pm7MenuInstance.close()}),this.isOpen=!0,this.content.classList.add("pm7-menu-content--open"),this.content.setAttribute("data-state","open"),this.trigger.setAttribute("aria-expanded","true"),document.addEventListener("keydown",this.boundHandlers.escape),this.adjustPosition(),requestAnimationFrame(()=>{this.currentIndex=0,this.focusItem(0)}),this.element.dispatchEvent(new CustomEvent("pm7:menu:open",{detail:{menu:this},bubbles:!0}))}close(){if(!this.isOpen)return;this.isOpen=!1,this.content.classList.remove("pm7-menu-content--open"),this.content.setAttribute("data-state","closed"),this.trigger.setAttribute("aria-expanded","false"),this.currentIndex=-1,document.removeEventListener("keydown",this.boundHandlers.escape),this.hoverTimeouts.forEach(t=>clearTimeout(t)),this.hoverTimeouts.clear(),this.element.querySelectorAll(".pm7-menu-item--has-submenu").forEach(t=>{t.setAttribute("data-submenu-open","false")}),this.items.forEach(t=>{t.setAttribute("tabindex","-1"),t.classList.remove("pm7-menu-item--clicking")}),this.element.dispatchEvent(new CustomEvent("pm7:menu:close",{detail:{menu:this},bubbles:!0}))}handleTriggerKeyDown(e){switch(e.key){case"Enter":case" ":case"ArrowDown":e.preventDefault(),this.open();break;case"ArrowUp":e.preventDefault(),this.open(),this.currentIndex=this.items.length-1,this.focusItem(this.currentIndex);break}}handleMenuKeyDown(e){switch(e.key){case"ArrowDown":e.preventDefault(),this.focusNext();break;case"ArrowUp":e.preventDefault(),this.focusPrevious();break;case"Home":e.preventDefault(),this.focusItem(0);break;case"End":e.preventDefault(),this.focusItem(this.items.length-1);break;case"Enter":case" ":e.preventDefault();const t=this.items[this.currentIndex];t&&!t.disabled&&t.click();break;case"Tab":this.close();break}}focusNext(){const e=this.currentIndex+1;e<this.items.length?this.focusItem(e):this.focusItem(0)}focusPrevious(){const e=this.currentIndex-1;e>=0?this.focusItem(e):this.focusItem(this.items.length-1)}focusItem(e){const t=this.items[e];t&&this.currentIndex!==e&&(this.currentIndex>=0&&this.items[this.currentIndex]&&this.items[this.currentIndex].setAttribute("tabindex","-1"),this.currentIndex=e,t.setAttribute("tabindex","0"),t.focus())}handleItemClick(e,t){if(t.classList.contains("pm7-menu-item--has-submenu")||(this.close(),this.trigger.focus()),t.classList.contains("pm7-menu-item--checkbox")){const n=t.getAttribute("data-checked")==="true";t.setAttribute("data-checked",!n)}if(t.classList.contains("pm7-menu-item--radio")&&(this.element.querySelectorAll(".pm7-menu-item--radio").forEach(s=>s.setAttribute("data-checked","false")),t.setAttribute("data-checked","true")),t.classList.contains("pm7-menu-item--has-submenu")){e.preventDefault(),e.stopPropagation();const n=t.getAttribute("data-submenu-open")==="true";t.setAttribute("data-submenu-open",!n);return}const i=new CustomEvent("pm7-menu-select",{detail:{item:t,menu:this},bubbles:!0});this.element.dispatchEvent(i)}adjustPosition(){const e=this.trigger.getBoundingClientRect(),t=this.content.getBoundingClientRect(),i=window.innerHeight,n=window.innerWidth,s=i-e.bottom,r=e.top;if(t.height>s&&r>s?this.content.classList.add("pm7-menu-content--top"):this.content.classList.remove("pm7-menu-content--top"),this.content.classList.contains("pm7-menu-content--end")&&e.right<t.width&&(this.content.classList.remove("pm7-menu-content--end"),this.content.classList.add("pm7-menu-content--start")),this.content.classList.contains("pm7-menu-content--center")){const o=e.left+e.width/2,a=t.width/2;o-a<0?(this.content.classList.remove("pm7-menu-content--center"),this.content.classList.add("pm7-menu-content--start")):o+a>n&&(this.content.classList.remove("pm7-menu-content--center"),this.content.classList.add("pm7-menu-content--end"))}}isAnyMenuBarMenuOpen(){if(!this.isInMenuBar)return!1;const e=this.element.closest(".pm7-menu-bar");if(!e)return!1;const t=e.querySelectorAll(".pm7-menu");for(const i of t){if(i===this.element)continue;const n=i.querySelector(".pm7-menu-content");if(n&&n.classList.contains("pm7-menu-content--open"))return!0}return!1}initSubmenuHoverHandling(){this.element.querySelectorAll(".pm7-menu-item--has-submenu").forEach((t,i)=>{const n=t.nextElementSibling;if(!n||!n.classList.contains("pm7-submenu"))return;const s=`submenu-${i}`;t.addEventListener("mouseenter",()=>{const r=this.hoverTimeouts.get(s);r&&(clearTimeout(r),this.hoverTimeouts.delete(s)),t.setAttribute("data-submenu-open","true")}),t.addEventListener("mouseleave",r=>{const o=r.relatedTarget;if(o&&(n.contains(o)||n===o))return;const a=setTimeout(()=>{t.setAttribute("data-submenu-open","false"),this.hoverTimeouts.delete(s)},100);this.hoverTimeouts.set(s,a)}),n.addEventListener("mouseenter",()=>{const r=this.hoverTimeouts.get(s);r&&(clearTimeout(r),this.hoverTimeouts.delete(s)),t.setAttribute("data-submenu-open","true")}),n.addEventListener("mouseleave",r=>{const o=r.relatedTarget;if(o&&(t.contains(o)||t===o))return;const a=setTimeout(()=>{t.setAttribute("data-submenu-open","false"),this.hoverTimeouts.delete(s)},100);this.hoverTimeouts.set(s,a)})})}};m(c,"instances",new WeakMap);let d=c;if(typeof document<"u"&&!window.__PM7_MENU_INIT__){window.__PM7_MENU_INIT__=!0;const u=()=>{document.querySelectorAll("[data-pm7-menu]:not([data-pm7-menu-initialized])").forEach(t=>{try{new d(t)}catch(i){console.error("[PM7Menu] Error initializing menu:",i)}})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u,{once:!0}):setTimeout(u,0)}export{d as P};
