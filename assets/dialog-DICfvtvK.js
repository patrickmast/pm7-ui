class E{constructor(e){this.element=e,this.element.classList.contains("pm7-dialog")||this.element.classList.add("pm7-dialog"),this.backdrop=e.querySelector(".pm7-dialog-overlay"),this.closeButton=e.querySelector(".pm7-dialog-close"),this.isOpen=!1,this.previousActiveElement=null,this.focusableElements=[],this.init()}init(){this.closeButton&&this.closeButton.addEventListener("click",()=>this.close()),this.backdrop&&this.backdrop.addEventListener("click",e=>{e.target===this.backdrop&&this.close()}),this.handleEscape=e=>{e.key==="Escape"&&this.isOpen&&(e.stopImmediatePropagation(),this.close())},this.handleTab=e=>{e.key==="Tab"&&this.isOpen&&this.trapFocus(e)}}open(){this.isOpen||(this.closeAllMenus(),this.isOpen=!0,this.previousActiveElement=document.activeElement,this.element.setAttribute("data-state","open"),document.body.classList.add("pm7-dialog-open"),this.setupFocusTrap(),document.addEventListener("keydown",this.handleEscape),document.addEventListener("keydown",this.handleTab),requestAnimationFrame(()=>{const e=this.focusableElements[0];e?e.focus():this.closeButton&&this.closeButton.focus()}),this.element.dispatchEvent(new CustomEvent("pm7-dialog-open",{detail:{dialog:this},bubbles:!0})))}close(){this.isOpen&&(this.isOpen=!1,this.element.setAttribute("data-state","closed"),document.body.classList.remove("pm7-dialog-open"),document.removeEventListener("keydown",this.handleEscape),document.removeEventListener("keydown",this.handleTab),this.previousActiveElement&&this.previousActiveElement.focus(),this.element.dispatchEvent(new CustomEvent("pm7-dialog-close",{detail:{dialog:this},bubbles:!0})))}setupFocusTrap(){const e='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';this.focusableElements=Array.from(this.element.querySelectorAll(e)).filter(n=>!n.disabled&&n.offsetParent!==null)}trapFocus(e){if(this.focusableElements.length===0)return;const n=this.focusableElements[0],o=this.focusableElements[this.focusableElements.length-1];e.shiftKey?document.activeElement===n&&(e.preventDefault(),o.focus()):document.activeElement===o&&(e.preventDefault(),n.focus())}closeAllMenus(){var n;if(document.querySelectorAll('.pm7-menu-content--open, .pm7-menu-content[data-state="open"]').forEach(o=>{o.classList.remove("pm7-menu-content--open"),o.removeAttribute("data-state");const l=o.closest(".pm7-menu");if(l){const c=l.querySelector(".pm7-menu-trigger");c&&c.setAttribute("aria-expanded","false")}}),typeof window<"u"&&((n=window.PM7)!=null&&n.Menu)){const o=window.PM7.Menu;o.instances&&o.instances.forEach&&o.instances.forEach(l=>{l.isOpen&&l.close()})}}shake(){this.element.classList.add("pm7-dialog--shake"),setTimeout(()=>{this.element.classList.remove("pm7-dialog--shake")},200)}setLoading(e){e?this.element.classList.add("pm7-dialog--loading"):this.element.classList.remove("pm7-dialog--loading")}}function w(t={}){const{title:e="Dialog",content:n="",size:o="md",variant:l="",showClose:c=!0,buttons:u=[]}=t,r=document.createElement("div");r.className="pm7-dialog-overlay";const a=document.createElement("div");a.className=`pm7-dialog pm7-dialog--${o}`,l&&(a.className+=` pm7-dialog--${l}`);const p=document.createElement("div");p.className="pm7-dialog-header";const m=document.createElement("h2");if(m.className="pm7-dialog-title",m.textContent=e,p.appendChild(m),c){const s=document.createElement("button");s.className="pm7-dialog-close",s.innerHTML="Ã—",s.setAttribute("aria-label","Close dialog"),p.appendChild(s)}a.appendChild(p);const i=document.createElement("div");if(i.className="pm7-dialog-body",typeof n=="string"?i.innerHTML=n:i.appendChild(n),a.appendChild(i),u.length>0){const s=document.createElement("div");s.className="pm7-dialog-footer",u.forEach(g=>{const v=document.createElement("button");v.className=`pm7-button pm7-button--${g.variant||"primary"}`,v.textContent=g.text,g.onClick&&v.addEventListener("click",g.onClick),s.appendChild(v)}),a.appendChild(s)}const d=document.createElement("div");d.appendChild(r),d.appendChild(a),document.body.appendChild(d);const h=new E(d);return d.addEventListener("pm7-dialog-close",()=>{setTimeout(()=>{document.body.removeChild(d)},300)}),h}function x(t,e={}){return new Promise(n=>{const o=w({title:e.title||"Confirm",content:t,size:"sm",buttons:[{text:e.cancelText||"Cancel",variant:"outline",onClick:()=>{o.close(),n(!1)}},{text:e.confirmText||"Confirm",variant:e.variant||"primary",onClick:()=>{o.close(),n(!0)}}]});o.open()})}function M(t,e={}){return new Promise(n=>{const o=w({title:e.title||"Alert",content:t,size:"sm",variant:e.variant,buttons:[{text:e.buttonText||"OK",variant:"primary",onClick:()=>{o.close(),n()}}]});o.open()})}const f=new Map;function C(){var e;if(document.querySelectorAll('.pm7-menu-content--open, .pm7-menu-content[data-state="open"]').forEach(n=>{n.classList.remove("pm7-menu-content--open"),n.removeAttribute("data-state");const o=n.closest(".pm7-menu");if(o){const l=o.querySelector(".pm7-menu-trigger");l&&l.setAttribute("aria-expanded","false")}}),typeof window<"u"&&((e=window.PM7)!=null&&e.Menu)){const n=window.PM7.Menu;n.instances&&n.instances.forEach&&n.instances.forEach(o=>{o.isOpen&&o.close()})}}const k={info:`<svg class="pm7-dialog-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" style="color: rgb(28, 134, 239);">
    <path d="M3 12a9 9 0 1 0 18 0 9 9 0 0 0-18 0m9-3h.01"></path>
    <path d="M11 12h1v4h1"></path>
  </svg>`,warning:`<svg class="pm7-dialog-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" style="color: rgb(245, 158, 11);">
    <path d="M12 9v4m0 4h.01M5.07 19H19a2 2 0 0 0 1.75-2.95L13.75 4a2 2 0 0 0-3.5 0L3.25 16.05A2 2 0 0 0 5.07 19z"></path>
  </svg>`,error:`<svg class="pm7-dialog-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" style="color: rgb(239, 68, 68);">
    <circle cx="12" cy="12" r="10"></circle>
    <line x1="15" y1="9" x2="9" y2="15"></line>
    <line x1="9" y1="9" x2="15" y2="15"></line>
  </svg>`,success:`<svg class="pm7-dialog-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" style="color: rgb(34, 197, 94);">
    <circle cx="12" cy="12" r="10"></circle>
    <path d="M9 12l2 2 4-4"></path>
  </svg>`};function y(t){if(t.querySelector(".pm7-dialog-overlay"))return;t.getAttribute("data-pm7-dialog");const e=t.getAttribute("data-pm7-dialog-size")||"md",n=t.hasAttribute("data-pm7-show-close"),o=t.hasAttribute("data-pm7-no-escape"),l=t.hasAttribute("data-pm7-no-overlay-close"),c=t.querySelector("[data-pm7-header]"),u=t.querySelector("[data-pm7-body]"),r=t.querySelector("[data-pm7-footer]"),a={header:c?{content:c.innerHTML,title:c.getAttribute("data-pm7-dialog-title"),subtitle:c.getAttribute("data-pm7-dialog-subtitle"),icon:c.getAttribute("data-pm7-dialog-icon"),separator:c.hasAttribute("data-pm7-header-separator")}:null,body:u?u.innerHTML:null,footer:r?r.innerHTML:null};t.innerHTML="",t.classList.contains("pm7-dialog")||t.classList.add("pm7-dialog");const p=document.createElement("div");p.className="pm7-dialog-overlay",t.appendChild(p);const m=document.createElement("div");if(m.className=`pm7-dialog-content pm7-dialog-content--${e}`,a.header){const i=document.createElement("div");i.className="pm7-dialog-header";const d=document.createElement("div");if(d.className="pm7-dialog-header-text",a.header.title){const s=document.createElement("h2");s.className="pm7-dialog-title",s.textContent=a.header.title,d.appendChild(s)}if(a.header.subtitle){const s=document.createElement("p");s.className="pm7-dialog-description",s.textContent=a.header.subtitle,d.appendChild(s)}i.appendChild(d);const h=document.createElement("div");if(h.className="pm7-dialog-header-actions",a.header.icon){const s=document.createElement("div");s.className="pm7-dialog-icon",s.innerHTML=k[a.header.icon]||"",h.appendChild(s)}if(n){const s=document.createElement("button");s.className="pm7-dialog-close",s.setAttribute("aria-label","Close"),s.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>`,h.appendChild(s)}if(i.appendChild(h),m.appendChild(i),a.header.separator){const s=document.createElement("div");s.className="pm7-dialog-header-separator",m.appendChild(s)}}if(a.body!==null){const i=document.createElement("div");i.className="pm7-dialog-body",i.innerHTML=a.body,m.appendChild(i)}if(a.footer!==null){const i=document.createElement("div");i.className="pm7-dialog-footer",i.innerHTML=a.footer,m.appendChild(i)}t.appendChild(m),t._dialogSettings={closeOnEscape:!o,closeOnOverlay:!l},t.setAttribute("data-state","closed")}function A(t){const e=document.querySelector(`[data-pm7-dialog="${t}"]`);if(!e){console.warn(`Dialog with id "${t}" not found`);return}const n=!e.querySelector(".pm7-dialog-overlay");if((e.querySelector("[data-pm7-header]")||e.querySelector("[data-pm7-body]")||e.querySelector("[data-pm7-footer]"))&&n){const r=e.getAttribute("data-state");if(r!=="open"&&r!=="closing")y(e);else{if(r==="open")return;if(r==="closing")return}}else n&&y(e);if(e.getAttribute("data-state")==="open"||e.getAttribute("data-state")==="closing")return;C(),e.setAttribute("data-state","open"),document.body.classList.add("pm7-dialog-open");const l=e._dialogSettings||{},c=e.querySelector(".pm7-dialog-overlay"),u=e.querySelector(".pm7-dialog-close");if(c&&l.closeOnOverlay!==!1&&(c.onclick=()=>b(t)),u&&(u.onclick=()=>b(t)),l.closeOnEscape!==!1){const r=a=>{a.key==="Escape"&&b(t)};f.has(t)&&document.removeEventListener("keydown",f.get(t)),f.set(t,r),document.addEventListener("keydown",r)}}function b(t){const e=document.querySelector(`[data-pm7-dialog="${t}"]`);e&&(e.setAttribute("data-state","closing"),e.classList.remove("pm7-dialog--open"),setTimeout(()=>{e.setAttribute("data-state","closed"),document.querySelectorAll('.pm7-dialog[data-state="open"]').length===0&&document.body.classList.remove("pm7-dialog-open")},200),f.has(t)&&(document.removeEventListener("keydown",f.get(t)),f.delete(t)))}function L(){document.querySelectorAll("[data-pm7-dialog]:not([data-state])").forEach(e=>{y(e),e.setAttribute("data-state","closed")})}typeof document<"u"&&document.addEventListener("DOMContentLoaded",L);typeof window<"u"&&(window.openDialog=A,window.closeDialog=b);export{E as PM7Dialog,L as autoInitDialogs,b as closeDialog,w as createDialog,A as openDialog,M as pm7Alert,x as pm7Confirm};
