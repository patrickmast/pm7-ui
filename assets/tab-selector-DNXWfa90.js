var u=Object.defineProperty;var p=(r,t,e)=>t in r?u(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var b=(r,t,e)=>p(r,typeof t!="symbol"?t+"":t,e);const n=class n{constructor(t){const e=t.hasAttribute("data-pm7-tab-initialized"),a=n.instances.has(t);if(e&&!a&&(console.log("[PM7TabSelector] Self-healing: Re-initializing tabs after framework re-render"),t.removeAttribute("data-pm7-tab-initialized")),n.instances.has(t))return n.instances.get(t);this.element=t;const s=this.preserveState();if(this.element.classList.contains("pm7-tab-selector")||this.element.classList.add("pm7-tab-selector"),this.tabList=t.querySelector(".pm7-tab-list"),this.tabs=Array.from(t.querySelectorAll(".pm7-tab-trigger")).filter(i=>i.closest("[data-pm7-tab-selector]")===t),this.panels=Array.from(t.querySelectorAll(".pm7-tab-content")).filter(i=>i.closest("[data-pm7-tab-selector]")===t),this.activeTab=null,this.eventListeners=new Map,!this.tabList||this.tabs.length===0){console.warn("PM7TabSelector: Missing required elements");return}n.instances.set(t,this),t._pm7TabSelectorInstance=this,this.init(),s&&s.activeTabIndex!==-1&&this.restoreState(s),t.setAttribute("data-pm7-tab-initialized","true")}preserveState(){var s;const t=this.element.querySelector('.pm7-tab-trigger[data-state="active"], .pm7-tab-trigger--active'),e=Array.from(this.element.querySelectorAll(".pm7-tab-trigger")).filter(i=>i.closest("[data-pm7-tab-selector]")===this.element);return{activeTabIndex:t?e.indexOf(t):-1,tabListId:(s=this.element.querySelector(".pm7-tab-list"))==null?void 0:s.id}}restoreState(t){t.activeTabIndex!==-1&&t.activeTabIndex<this.tabs.length&&setTimeout(()=>{this.selectTab(this.tabs[t.activeTabIndex])},0)}cleanup(){this.eventListeners.forEach(({element:t,type:e,handler:a})=>{t.removeEventListener(e,a)}),this.eventListeners.clear()}destroy(){this.cleanup(),n.instances.delete(this.element),delete this.element._pm7TabSelectorInstance}init(){this.cleanup(),this.tabList.setAttribute("role","tablist"),this.tabs.forEach((e,a)=>{const s=this.panels[a];let i=e.getAttribute("aria-controls");i||(i=(s==null?void 0:s.id)||`pm7-tab-panel-${Math.random().toString(36).substr(2,9)}`,e.setAttribute("aria-controls",i)),e.setAttribute("role","tab"),e.setAttribute("tabindex","-1"),s&&(s.setAttribute("role","tabpanel"),s.id||s.setAttribute("id",i),s.setAttribute("aria-labelledby",e.id||(e.id=`pm7-tab-${Math.random().toString(36).substr(2,9)}`)),s.setAttribute("tabindex","0"));const o=()=>this.selectTab(e),c=h=>this.handleKeyDown(h);e.addEventListener("click",o),e.addEventListener("keydown",c),this.eventListeners.set(`click-${a}`,{element:e,type:"click",handler:o}),this.eventListeners.set(`keydown-${a}`,{element:e,type:"keydown",handler:c})});const t=this.tabs.find(e=>e.getAttribute("data-state")==="active"||e.classList.contains("pm7-tab-trigger--active"))||this.tabs[0];this.selectTab(t),t&&t.setAttribute("tabindex","0")}selectTab(t){if(!t||t.disabled||t===this.activeTab)return;const e=this.tabs.indexOf(t),a=this.panels[e];this.tabs.forEach((i,o)=>{i.setAttribute("data-state","inactive"),i.setAttribute("aria-selected","false"),i.setAttribute("tabindex","-1"),i.classList.remove("pm7-tab-trigger--active");const c=this.panels[o];c&&(c.setAttribute("data-state","inactive"),c.classList.remove("pm7-tab-content--active"))}),t.setAttribute("data-state","active"),t.setAttribute("aria-selected","true"),t.setAttribute("tabindex","0"),t.classList.add("pm7-tab-trigger--active"),a&&(a.setAttribute("data-state","active"),a.classList.add("pm7-tab-content--active")),this.activeTab=t;const s=new CustomEvent("pm7-tab-change",{detail:{tab:t,panel:a,index:e},bubbles:!0});this.element.dispatchEvent(s)}handleKeyDown(t){const e=this.tabs.indexOf(t.target);let a=-1;switch(t.key){case"ArrowLeft":case"ArrowUp":t.preventDefault(),a=e-1,a<0&&(a=this.tabs.length-1);break;case"ArrowRight":case"ArrowDown":t.preventDefault(),a=e+1,a>=this.tabs.length&&(a=0);break;case"Home":t.preventDefault(),a=0;break;case"End":t.preventDefault(),a=this.tabs.length-1;break;case"Enter":case" ":t.preventDefault(),this.selectTab(t.target);return}if(a!==-1){const s=this.tabs[a];s&&!s.disabled&&(this.selectTab(s),s.focus())}}selectTabByIndex(t){t>=0&&t<this.tabs.length&&this.selectTab(this.tabs[t])}getActiveTabIndex(){return this.tabs.indexOf(this.activeTab)}};b(n,"instances",new WeakMap);let l=n;function m(){document.querySelectorAll("[data-pm7-tab-selector][data-pm7-tab-initialized]:not([data-pm7-tab-healing])").forEach(t=>{(!t._pm7TabSelectorInstance||!l.instances.has(t))&&(t.setAttribute("data-pm7-tab-healing","true"),console.log("[PM7TabSelector] Healing tab selector:",t),new l(t),t.removeAttribute("data-pm7-tab-healing"))})}function d(){document.querySelectorAll("[data-pm7-tab-selector]:not([data-pm7-tab-initialized])").forEach(t=>{new l(t)})}typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",d,{once:!0}):setTimeout(d,0));l.heal=m;export{l as PM7TabSelector};
