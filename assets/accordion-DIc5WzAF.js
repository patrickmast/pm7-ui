var m=Object.defineProperty;var g=(l,t,e)=>t in l?m(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var u=(l,t,e)=>g(l,typeof t!="symbol"?t+"":t,e);const o=class o{constructor(t,e={}){const i=t.hasAttribute("data-pm7-accordion-initialized"),s=o.instances.has(t);if(i&&!s&&(console.log("[PM7Accordion] Self-healing: Re-initializing accordion after framework re-render"),t.removeAttribute("data-pm7-accordion-initialized")),o.instances.has(t))return o.instances.get(t);this.element=t;const a=this.preserveState();this.element.classList.contains("pm7-accordion")||this.element.classList.add("pm7-accordion"),this.options={allowMultiple:!1,defaultOpen:null,iconPosition:"end",textAlign:"left",height:null,fixedHeight:300,...e},this.items=[],this.eventListeners=new Map,o.instances.set(t,this),t._pm7AccordionInstance=this,this.init(),a&&a.openItems.length>0&&this.restoreState(a),t.setAttribute("data-pm7-accordion-initialized","true")}preserveState(){const t=this.element.querySelectorAll(".pm7-accordion-item"),e=[];return t.forEach((i,s)=>{i.getAttribute("data-state")==="open"&&e.push(s)}),{openItems:e,options:this.element.dataset}}restoreState(t){t.openItems.forEach(e=>{e<this.items.length&&setTimeout(()=>{this.open(e)},0)})}init(){this.cleanup(),this.options.iconPosition==="start"&&this.element.classList.add("pm7-accordion--icon-start"),this.options.textAlign&&this.options.textAlign!=="left"&&this.element.classList.add(`pm7-accordion--text-${this.options.textAlign}`),this.options.height&&(this.element.classList.add(`pm7-accordion--height-${this.options.height}`),this.options.height==="fixed"&&this.options.fixedHeight&&this.element.style.setProperty("--pm7-accordion-fixed-height",`${this.options.fixedHeight}px`)),this.element.querySelectorAll(".pm7-accordion-item").forEach((e,i)=>{const s=e.querySelector(".pm7-accordion-trigger"),a=e.querySelector(".pm7-accordion-content");if(!s||!a)return;let n=s.querySelector(".pm7-accordion-icon");n||(n=document.createElementNS("http://www.w3.org/2000/svg","svg"),n.setAttribute("class","pm7-accordion-icon"),n.setAttribute("width","16"),n.setAttribute("height","16"),n.setAttribute("viewBox","0 0 12 12"),n.innerHTML='<path d="M2.5 4L6 7.5L9.5 4" stroke="currentColor" stroke-width="1.5" fill="none"/>',s.appendChild(n)),this.items.push({item:e,trigger:s,content:a});const r=this.options.defaultOpen===i||this.options.defaultOpen==="all"||e.getAttribute("data-state")==="open";r&&e.setAttribute("data-initial","true"),this.setItemState(e,s,a,r),r&&setTimeout(()=>{e.removeAttribute("data-initial")},50);const h=()=>this.toggle(i),p=d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),this.toggle(i))};s.addEventListener("click",h),s.addEventListener("keydown",p),this.eventListeners.set(`click-${i}`,{element:s,type:"click",handler:h}),this.eventListeners.set(`keydown-${i}`,{element:s,type:"keydown",handler:p})})}cleanup(){this.eventListeners.forEach(({element:t,type:e,handler:i})=>{t.removeEventListener(e,i)}),this.eventListeners.clear()}destroy(){this.cleanup(),o.instances.delete(this.element),delete this.element._pm7AccordionInstance}toggle(t){const{item:e,trigger:i,content:s}=this.items[t],a=e.getAttribute("data-state")==="open";a?this.setItemState(e,i,s,!1):(this.options.allowMultiple||this.items.forEach((n,r)=>{r!==t&&n.item.getAttribute("data-state")==="open"&&this.setItemState(n.item,n.trigger,n.content,!1)}),this.setItemState(e,i,s,!0)),this.element.dispatchEvent(new CustomEvent("pm7:accordion:toggle",{detail:{index:t,isOpen:!a},bubbles:!0}))}setItemState(t,e,i,s){if(s){t.setAttribute("data-state","open"),e.setAttribute("aria-expanded","true"),i.setAttribute("data-state","open");const a=i.scrollHeight;i.style.setProperty("--pm7-accordion-content-height",`${a}px`)}else if(i.getAttribute("data-state")==="open"){const a=i.scrollHeight;i.style.setProperty("--pm7-accordion-content-height",`${a}px`),i.setAttribute("data-state","closing"),setTimeout(()=>{t.setAttribute("data-state","closed"),e.setAttribute("aria-expanded","false"),i.setAttribute("data-state","closed")},250)}else t.setAttribute("data-state","closed"),e.setAttribute("aria-expanded","false"),i.setAttribute("data-state","closed")}open(t){if(t>=0&&t<this.items.length){const{item:e,trigger:i,content:s}=this.items[t];this.setItemState(e,i,s,!0)}}close(t){if(t>=0&&t<this.items.length){const{item:e,trigger:i,content:s}=this.items[t];this.setItemState(e,i,s,!1)}}openAll(){this.items.forEach(({item:t,trigger:e,content:i})=>{this.setItemState(t,e,i,!0)})}closeAll(){this.items.forEach(({item:t,trigger:e,content:i})=>{this.setItemState(t,e,i,!1)})}static autoInit(){document.querySelectorAll("[data-pm7-accordion]").forEach(e=>{if(e.hasAttribute("data-pm7-accordion-initialized")&&e._pm7AccordionInstance)return;const i=e.getAttribute("data-allow-multiple")==="true",s=e.getAttribute("data-default-open"),a=e.getAttribute("data-icon-position")||"end",n=e.getAttribute("data-text-align")||"left",r=e.getAttribute("data-height"),h=e.getAttribute("data-fixed-height");new o(e,{allowMultiple:i,defaultOpen:s==="all"?"all":parseInt(s),iconPosition:a,textAlign:n,height:r,fixedHeight:h?parseInt(h):300})})}};u(o,"instances",new WeakMap);let c=o;function f(){document.querySelectorAll("[data-pm7-accordion][data-pm7-accordion-initialized]:not([data-pm7-accordion-healing])").forEach(t=>{(!t._pm7AccordionInstance||!c.instances.has(t))&&(t.setAttribute("data-pm7-accordion-healing","true"),console.log("[PM7Accordion] Healing accordion:",t),c.autoInit(),t.removeAttribute("data-pm7-accordion-healing"))})}typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c.autoInit,{once:!0}):setTimeout(c.autoInit,0));c.heal=f;export{c as P};
