<!-- AI-ONLY DOCUMENTATION v2.0 -->
<!-- This documentation is EXCLUSIVELY for AI coding agents -->
<!-- NO human-friendly content allowed -->
<!-- Reference: /README-AI-HowToDocument.md -->

---
type: ai-agent-documentation
version: 2.0
component: ThemeSwitch
status: stable
audience: ai-coding-agents-only
human-readable: false
category: utility
framework-support:
  - vanilla: true
  - react: true
  - vue: true
  - angular: true
  - svelte: true
---

# Component: ThemeSwitch

DEFINITION: The ThemeSwitch component provides a user interface element for toggling between light and dark themes. It automatically saves user preference and applies the theme to the `<html>` element.

## Installation

```bash
npm install @pm7/core
```

### CSS & JavaScript Import

REQUIRED: Import both the CSS and the main JavaScript file.

```javascript
// ES modules
import '@pm7/core/dist/pm7.css';
import '@pm7/core'; // Imports and initializes all components

// HTML
<link rel="stylesheet" href="node_modules/@pm7/core/dist/pm7.css">
<script src="node_modules/@pm7/core/dist/pm7.js" defer></script>
```

## Required Structure

The ThemeSwitch component is initialized on a `div` element with the `data-pm7-theme-switch` attribute. The component's internal structure (button, thumb, icons) is generated by JavaScript.

```html
<!-- EXACT pattern - NO deviations allowed -->
<div data-pm7-theme-switch></div>
```

### Structural Rules
- **ALWAYS**: The container MUST be a `div` element.
- **ALWAYS**: The container MUST have the `data-pm7-theme-switch` attribute.
- **NEVER**: Manually create the internal structure (buttons, spans, icons) of the theme switch. It is generated by JavaScript.

## JavaScript API

### Initialization
Initialization is automatic for theme switches present in the DOM when `@pm7/core` is imported. For dynamically added theme switches, re-initialization is required.

```javascript
// For components added after initial page load
window.PM7.init();
```

### Instance Access

```javascript
const element = document.querySelector('[data-pm7-theme-switch]');
const instance = element.PM7ThemeSwitch;
```

### Methods

| Method | Parameters | Return Type | Description |
|---|---|---|---|
| `setTheme` | `theme: 'light' | 'dark'` | `void` | Sets the theme to 'light' or 'dark'. |
| `getTheme` | `(none)` | `'light' | 'dark'` | Returns the current active theme. |
| `toggle` | `(none)` | `void` | Toggles the theme between light and dark. |
| `destroy` | `(none)` | `void` | Removes all event listeners and cleans up the instance. |

### Options

Options can be set via `data-` attributes on the `data-pm7-theme-switch` element.

| Attribute | Type | Default | Description |
|---|---|---|---|
| `data-default-theme` | `'light' | 'dark'` | `system preference` | Overrides the initial theme detection. |
| `data-storage-key` | `string` | `'pm7-theme'` | Custom key for storing theme preference in `localStorage`. |
| `data-apply-to-root` | `boolean` | `true` | If `false`, prevents the component from adding the `dark` class to `<html>`. |

### Events

| Event | When | Detail | Bubbles |
|---|---|---|---|---|
| `pm7:theme-switch:change` | After the theme changes | `{ theme: 'light' | 'dark' }` | YES |

## Attributes

See /docs/ATTRIBUTES.md for cross-component attribute relationships.

| Attribute | Component(s) | Values | Required | Effect |
|---|---|---|---|---|
| `data-pm7-theme-switch` | ThemeSwitch | presence | YES | Initializes ThemeSwitch component. |
| `data-default-theme` | ThemeSwitch | `light`, `dark` | NO | Overrides system preference for initial theme. |
| `data-storage-key` | ThemeSwitch | string | NO | Custom key for storing theme preference in `localStorage`. |
| `data-apply-to-root` | ThemeSwitch | `true`, `false` | NO | Controls whether `dark` class is applied to `<html>`. |
| `aria-checked` | ThemeSwitch | `true`, `false` | AUTO | Indicates the current checked state of a switch. |
| `role` | ThemeSwitch | `switch` | AUTO | Defines the purpose or nature of an element. |

## CSS Classes

| Class | Required | When | Effect |
|---|---|---|---|
| `.pm7-theme-switch` | AUTO | Applied by JS to the main container | Base styling for the theme switch. |
| `.pm7-theme-switch--sm` | NO | For a smaller switch | Reduces the size of the switch. |
| `.pm7-theme-switch--lg` | NO | For a larger switch | Increases the size of the switch. |
| `.pm7-theme-switch--disabled` | NO | To disable user interaction | Styles the switch as disabled. |
| `.pm7-theme-switch--no-hover` | NO | To remove hover effects | Disables visual feedback on hover. |
| `.pm7-theme-switch--label-start` | NO | To position label before switch | Aligns the label to the left of the switch. |
| `.pm7-theme-switch--fixed` | NO | For a fixed position switch with label | Positions the switch at a fixed screen location with a label. |
| `.pm7-theme-switch--fixed-icon` | NO | For a fixed position icon-only switch | Positions the switch at a fixed screen location as an icon. |

## Patterns

### Pattern: Basic Theme Switch
```html
<div data-pm7-theme-switch></div>
```

### Pattern: Theme Switch with Label
```html
<div data-pm7-theme-switch>
  <span>Dark Mode</span>
</div>
```

### Pattern: Small Theme Switch
```html
<div data-pm7-theme-switch class="pm7-theme-switch--sm"></div>
```

### Pattern: Fixed Position Icon Switch
```html
<div class="pm7-theme-switch--fixed-icon" data-pm7-theme-switch></div>
```

### Pattern: Flicker Prevention Script
This script MUST be placed in the `<head>` of your HTML, before any stylesheets, to prevent a flash of unstyled content when switching to dark mode.

```html
<head>
  <script>
    (function() {
      const savedTheme = localStorage.getItem('pm7-theme'); // Use your data-storage-key if different
      if (savedTheme === 'dark' || (!savedTheme && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
  <!-- Your stylesheets go here -->
  <link rel="stylesheet" href="node_modules/@pm7/core/dist/pm7.css">
</head>
```

## Anti-Patterns

### NEVER: Manually create internal elements
```html
<!-- NEVER -->
<div data-pm7-theme-switch>
  <button class="pm7-theme-switch-button">...</button>
</div>

<!-- BECAUSE -->
The internal structure of the theme switch is dynamically generated by JavaScript. Manually adding these elements will lead to incorrect rendering and functionality.

<!-- INSTEAD -->
<div data-pm7-theme-switch></div>
```

### NEVER: Use a `<button>` element as the container
```html
<!-- NEVER -->
<button data-pm7-theme-switch>...</button>

<!-- BECAUSE -->
The component expects a `div` element as its container. Using a `<button>` will lead to incorrect styling and behavior.

<!-- INSTEAD -->
<div data-pm7-theme-switch></div>
```

### NEVER: Place flicker prevention script after stylesheets
```html
<!-- NEVER -->
<head>
  <link rel="stylesheet" href="styles.css">
  <script>/* flicker prevention script */</script>
</head>

<!-- BECAUSE -->
Placing the script after stylesheets will cause a brief flash of the default (light) theme before the dark theme is applied, especially on slower connections.

<!-- INSTEAD -->
<head>
  <script>/* flicker prevention script */</script>
  <link rel="stylesheet" href="styles.css">
</head>
```

## Rules

### ALWAYS
- **ALWAYS**: Use a `div` element as the container for the theme switch.
- **ALWAYS**: Include the `data-pm7-theme-switch` attribute on the container `div`.
- **ALWAYS**: Place the flicker prevention script in the `<head>` of your HTML, *before* any `<link rel="stylesheet">` tags.
- **ALWAYS**: Call `window.PM7.init()` after dynamically adding a theme switch to the DOM.

### NEVER
- **NEVER**: Manually create the internal HTML structure of the theme switch.
- **NEVER**: Use a `<button>` element as the theme switch container.
- **NEVER**: Apply custom styles to the internal elements of the theme switch; use the provided CSS variables or modifier classes instead.
- **NEVER**: Expect the theme switch to work without `window.PM7.init()` if it's added dynamically.

## CSS Variables

### Component-Specific Variables

| Variable | Light Mode | Dark Mode | Usage |
|----------|------------|-----------|--------|
| `--pm7-theme-switch-width` | `56px` | `56px` | Switch track width |
| `--pm7-theme-switch-height` | `28px` | `28px` | Switch track height |
| `--pm7-theme-switch-thumb-size` | `24px` | `24px` | Thumb diameter |
| `--pm7-theme-switch-gap` | `10px` | `10px` | Gap between switch and label |
| `--pm7-theme-switch-transition` | `all 0.1s ease` | `all 0.1s ease` | Animation timing |
| `--pm7-theme-switch-bg` | `var(--pm7-background)` | `var(--pm7-background)` | Track background |
| `--pm7-theme-switch-thumb-bg-light` | `#FFD43B` | `#FFD43B` | Light mode thumb color |
| `--pm7-theme-switch-thumb-bg-dark` | `#6E6E6E` | `#6E6E6E` | Dark mode thumb color |
| `--pm7-theme-switch-icon-light` | `var(--pm7-foreground)` | `var(--pm7-foreground)` | Light mode icon color |
| `--pm7-theme-switch-icon-dark` | `var(--pm7-background)` | `var(--pm7-background)` | Dark mode icon color |
| `--pm7-theme-switch-sun-color` | `#FFB800` | `#FFB800` | Sun icon color |
| `--pm7-theme-switch-moon-color` | `#4A5568` | `#93C5FD` | Moon icon color |

### Required Global Variables

| Variable | Light Mode | Dark Mode | Usage in ThemeSwitch |
|----------|------------|-----------|----------------------|
| `--pm7-background` | `#ffffff` | `#121212` | Track background, dark icon color |
| `--pm7-foreground` | `#000000` | `#e0e0e0` | Label text, light icon color |
| `--pm7-border` | `#e0e0e0` | `#444` | Track border |
| `--pm7-muted` | `#f5f5f5` | `#2d2d2d` | Track hover background |
| `--pm7-primary` | `#1C86EF` | `#3b9eff` | Hover border, focus outline |
| `--pm7-surface` | `#ffffff` | `#1e1e1e` | Fixed variant background |

### Customization Example
```css
/* Custom theme switch colors */
.my-app {
  --pm7-theme-switch-thumb-bg-light: #fbbf24;
  --pm7-theme-switch-thumb-bg-dark: #7c3aed;
  --pm7-theme-switch-sun-color: #f59e0b;
  --pm7-theme-switch-moon-color: #8b5cf6;
}

/* Smaller switch dimensions */
.compact-switch {
  --pm7-theme-switch-width: 48px;
  --pm7-theme-switch-height: 24px;
  --pm7-theme-switch-thumb-size: 20px;
}

/* No animations */
.no-motion {
  --pm7-theme-switch-transition: none;
}
```

## Cross-Component Dependencies

### Works With
- **All Components**: Theme switch affects global theming
- **Button**: Can be styled to look like a button
- **Icons**: Uses SVG icons for sun/moon

### Conflicts With
- **None**: Theme switch is independent and works with all components

## Accessibility

- **Role**: The component automatically applies `role="switch"` for semantic meaning.
- **ARIA**: `aria-checked` is automatically updated to reflect the current theme state.
- **Keyboard**: The switch is keyboard navigable (`Tab` to focus, `Space` or `Enter` to toggle).
- **Focus**: A visible focus indicator is provided.
- **Motion**: Respects `prefers-reduced-motion` for animations.

## Complete Example: Header with Theme Switch

SCENARIO: Integrating a theme switch into a website header for user-controlled theme preference.

```html
<header style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background-color: var(--pm7-card); border-bottom: 1px solid var(--pm7-border);">
  <a href="/" style="font-weight: bold; font-size: 1.2rem;">My App</a>
  <div style="display: flex; align-items: center; gap: 1rem;">
    <span>Theme:</span>
    <div data-pm7-theme-switch></div>
  </div>
</header>

<script type="module">
  // Example of listening to theme changes
  document.addEventListener('pm7:theme-switch:change', (e) => {
    console.log('Theme changed to:', e.detail.theme);
    // You can add custom logic here, e.g., send analytics event
  });
</script>
```
