<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TipTap Editor with PM7 Toolbar - PM7 UI</title>

  <!-- PM7 Core CSS -->
  <link rel="stylesheet" href="/packages/core/src/styles/index.css">
  
  <!-- TipTap Editor Dependencies -->
  <script type="module">
    import { Editor } from 'https://esm.sh/@tiptap/core@2.1.13'
    import StarterKit from 'https://esm.sh/@tiptap/starter-kit@2.1.13'
    import { Color } from 'https://esm.sh/@tiptap/extension-color@2.1.13'
    import TextStyle from 'https://esm.sh/@tiptap/extension-text-style@2.1.13'
    import Underline from 'https://esm.sh/@tiptap/extension-underline@2.1.13'
    import Link from 'https://esm.sh/@tiptap/extension-link@2.1.13'
    
    window.Editor = Editor;
    window.StarterKit = StarterKit;
    window.Color = Color;
    window.TextStyle = TextStyle;
    window.Underline = Underline;
    window.Link = Link;
  </script>

  <style>
    body {
      margin: 0;
      font-family: var(--pm7-font-sans);
      background: var(--pm7-background);
      color: var(--pm7-foreground);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .app-container {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .app-toolbar {
      background: var(--pm7-surface);
      border-bottom: 1px solid var(--pm7-border);
      padding: 0;
    }

    .app-content {
      flex: 1;
      padding: 1rem 2rem 2rem 2rem;
      width: 100%;
    }

    /* TipTap Editor Styles */
    .tiptap {
      background: var(--pm7-card);
      border: 1px solid var(--pm7-border);
      border-radius: var(--pm7-radius);
      padding: 1.5rem;
      min-height: 400px;
      font-family: var(--pm7-font-sans);
      font-size: 16px;
      line-height: 1.6;
      outline: none;
    }

    .tiptap:focus {
      border-color: var(--pm7-primary);
    }

    .tiptap h1, .tiptap h2, .tiptap h3 {
      font-weight: 600;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .tiptap h1 { font-size: 2rem; }
    .tiptap h2 { font-size: 1.5rem; }
    .tiptap h3 { font-size: 1.25rem; }

    .tiptap p {
      margin-bottom: 1rem;
    }

    .tiptap ul, .tiptap ol {
      margin-bottom: 1rem;
      padding-left: 2rem;
    }

    .tiptap code {
      background: var(--pm7-muted);
      padding: 0.125rem 0.25rem;
      border-radius: 0.25rem;
      font-family: var(--pm7-font-mono);
      font-size: 0.875em;
    }

    .tiptap pre {
      background: var(--pm7-muted);
      padding: 1rem;
      border-radius: var(--pm7-radius);
      overflow-x: auto;
      margin-bottom: 1rem;
    }

    .tiptap pre code {
      background: none;
      padding: 0;
    }

    .tiptap blockquote {
      border-left: 3px solid var(--pm7-border);
      padding-left: 1rem;
      margin-left: 0;
      font-style: italic;
      color: var(--pm7-muted-foreground);
    }

    .tiptap a {
      color: var(--pm7-primary);
      text-decoration: underline;
    }

    .tiptap a:hover {
      text-decoration: none;
    }

    /* Formatting toolbar */
    .format-toolbar {
      display: flex;
      gap: 0.25rem;
      padding: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
      justify-content: center;
    }

    .format-group {
      display: flex;
      gap: 0.25rem;
      padding: 0 0.5rem;
      border-right: 1px solid var(--pm7-border);
    }

    .format-group:last-child {
      border-right: none;
    }

    .format-button {
      padding: 0.25rem 0.5rem;
      background: transparent;
      border: 1px solid transparent;
      border-radius: var(--pm7-radius);
      cursor: pointer;
      font-size: 14px;
      color: var(--pm7-foreground);
      transition: all 0.2s;
    }

    .format-button:hover {
      background: var(--pm7-muted);
    }

    .format-button.is-active {
      background: var(--pm7-primary);
      color: var(--pm7-primary-foreground);
    }

    .status-bar {
      background: var(--pm7-muted);
      border-top: 1px solid var(--pm7-border);
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      color: var(--pm7-muted-foreground);
      display: flex;
      justify-content: space-between;
    }

    /* Resizable editor container */
    .editor-container {
      position: relative;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .editor-wrapper {
      position: relative;
      background: var(--pm7-card);
      border: 1px solid var(--pm7-border);
      border-radius: var(--pm7-radius);
      overflow: hidden;
      width: 800px; /* Default starting width */
    }

    /* Resize handle */
    .resize-handle {
      position: absolute;
      top: 0;
      width: 12px;
      cursor: ew-resize;
      background: transparent;
      z-index: 10;
    }

    .resize-handle.resizing {
      /* No visual change during resize */
    }

    /* Visual indicator */
    .resize-handle::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 2px;
      transform: translateY(-50%);
      width: 4px;
      height: 40px;
      background: var(--pm7-muted-foreground);
      border-radius: 2px;
      opacity: 0.5;
    }

    /* Keep handle appearance consistent during resize */

    /* Dialog backdrop styles */
    .pm7-dialog-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      display: none;
      z-index: var(--pm7-z-modal, 100);
    }
    
    .pm7-dialog-backdrop[data-state="open"] {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Ensure dialog close button matches PM7 style */
    #about-dialog .pm7-dialog-close {
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
    }

    /* Adjust TipTap styles for wrapper */
    .editor-wrapper .tiptap {
      border: none;
      border-radius: 0;
    }


  </style>
</head>
<body>
  <div class="app-container">
    <!-- Application Toolbar -->
    <div class="app-toolbar">
      <div class="pm7-menu-bar pm7-menu-bar--borderless pm7-menu-bar--flat-hover">
        <!-- File Menu -->
        <div class="pm7-menu" data-pm7-menu>
          <button class="pm7-menu-trigger pm7-button pm7-button--ghost pm7-button--sm">
            File
          </button>
          <div class="pm7-menu-content">
            <button class="pm7-menu-item" onclick="newFile()">
              New
              <span class="pm7-menu-shortcut">âŒ˜N</span>
            </button>
            <button class="pm7-menu-item" onclick="openFile()">
              Open...
              <span class="pm7-menu-shortcut">âŒ˜O</span>
            </button>
            <button class="pm7-menu-item">Recent Files</button>
            <div class="pm7-menu-separator"></div>
            <button class="pm7-menu-item" onclick="saveFile()">
              Save
              <span class="pm7-menu-shortcut">âŒ˜S</span>
            </button>
            <button class="pm7-menu-item">Save As...</button>
            <div class="pm7-menu-separator"></div>
            <button class="pm7-menu-item" onclick="exitApp()">Exit</button>
          </div>
        </div>

        <!-- Edit Menu -->
        <div class="pm7-menu" data-pm7-menu>
          <button class="pm7-menu-trigger pm7-button pm7-button--ghost pm7-button--sm">
            Edit
          </button>
          <div class="pm7-menu-content">
            <button class="pm7-menu-item" id="undo-btn">
              Undo
              <span class="pm7-menu-shortcut">âŒ˜Z</span>
            </button>
            <button class="pm7-menu-item" id="redo-btn">
              Redo
              <span class="pm7-menu-shortcut">âŒ˜â‡§Z</span>
            </button>
            <div class="pm7-menu-separator"></div>
            <button class="pm7-menu-item" id="cut-btn">
              Cut
              <span class="pm7-menu-shortcut">âŒ˜X</span>
            </button>
            <button class="pm7-menu-item" id="copy-btn">
              Copy
              <span class="pm7-menu-shortcut">âŒ˜C</span>
            </button>
            <button class="pm7-menu-item" id="paste-btn">
              Paste
              <span class="pm7-menu-shortcut">âŒ˜V</span>
            </button>
            <div class="pm7-menu-separator"></div>
            <button class="pm7-menu-item" id="select-all-btn">
              Select All
              <span class="pm7-menu-shortcut">âŒ˜A</span>
            </button>
          </div>
        </div>

        <!-- Format Menu -->
        <div class="pm7-menu" data-pm7-menu>
          <button class="pm7-menu-trigger pm7-button pm7-button--ghost pm7-button--sm">
            Format
          </button>
          <div class="pm7-menu-content">
            <button class="pm7-menu-item" id="bold-menu">
              Bold
              <span class="pm7-menu-shortcut">âŒ˜B</span>
            </button>
            <button class="pm7-menu-item" id="italic-menu">
              Italic
              <span class="pm7-menu-shortcut">âŒ˜I</span>
            </button>
            <button class="pm7-menu-item" id="underline-menu">
              Underline
              <span class="pm7-menu-shortcut">âŒ˜U</span>
            </button>
            <button class="pm7-menu-item" id="strike-menu">
              Strikethrough
            </button>
            <div class="pm7-menu-separator"></div>
            <button class="pm7-menu-item" id="h1-menu">Heading 1</button>
            <button class="pm7-menu-item" id="h2-menu">Heading 2</button>
            <button class="pm7-menu-item" id="h3-menu">Heading 3</button>
            <button class="pm7-menu-item" id="paragraph-menu">Paragraph</button>
            <div class="pm7-menu-separator"></div>
            <button class="pm7-menu-item" id="bullet-list-menu">Bullet List</button>
            <button class="pm7-menu-item" id="ordered-list-menu">Numbered List</button>
            <div class="pm7-menu-separator"></div>
            <button class="pm7-menu-item" id="code-menu">Code</button>
            <button class="pm7-menu-item" id="code-block-menu">Code Block</button>
            <button class="pm7-menu-item" id="blockquote-menu">Blockquote</button>
          </div>
        </div>

        <!-- View Menu -->
        <div class="pm7-menu" data-pm7-menu>
          <button class="pm7-menu-trigger pm7-button pm7-button--ghost pm7-button--sm">
            View
          </button>
          <div class="pm7-menu-content">
            <button class="pm7-menu-item pm7-menu-item--checkbox" id="show-toolbar" data-checked="true">
              Show Formatting Toolbar
            </button>
            <div class="pm7-menu-separator"></div>
            <div class="pm7-menu-label">Theme</div>
            <button class="pm7-menu-item pm7-menu-item--radio" data-name="theme" data-value="light" data-checked="true">
              Light
            </button>
            <button class="pm7-menu-item pm7-menu-item--radio" data-name="theme" data-value="dark">
              Dark
            </button>
          </div>
        </div>

        <!-- Tools Menu -->
        <div class="pm7-menu" data-pm7-menu>
          <button class="pm7-menu-trigger pm7-button pm7-button--ghost pm7-button--sm">
            Tools
          </button>
          <div class="pm7-menu-content">
            <button class="pm7-menu-item">Options...</button>
            <button class="pm7-menu-item">Extensions</button>
            <div class="pm7-menu-separator"></div>
            <button class="pm7-menu-item">Developer Tools</button>
          </div>
        </div>

        <!-- Help Menu -->
        <div class="pm7-menu" data-pm7-menu>
          <button class="pm7-menu-trigger pm7-button pm7-button--ghost pm7-button--sm">
            Help
          </button>
          <div class="pm7-menu-content">
            <button class="pm7-menu-item">Documentation</button>
            <button class="pm7-menu-item">Keyboard Shortcuts</button>
            <div class="pm7-menu-separator"></div>
            <button class="pm7-menu-item" onclick="showAbout()">About</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Area -->
    <main class="app-content">
      <h2 style="text-align: center;">TipTap Editor with PM7 Toolbar</h2>
      
      <!-- Formatting Toolbar (outside card) -->
      <div class="format-toolbar" id="format-toolbar">
        <div class="format-group">
          <button class="format-button" id="bold-btn" title="Bold (Cmd+B)">
            <strong>B</strong>
          </button>
          <button class="format-button" id="italic-btn" title="Italic (Cmd+I)">
            <em>I</em>
          </button>
          <button class="format-button" id="underline-btn" title="Underline (Cmd+U)">
            <u>U</u>
          </button>
          <button class="format-button" id="strike-btn" title="Strikethrough">
            <s>S</s>
          </button>
        </div>
        
        <div class="format-group">
          <button class="format-button" id="h1-btn" title="Heading 1">H1</button>
          <button class="format-button" id="h2-btn" title="Heading 2">H2</button>
          <button class="format-button" id="h3-btn" title="Heading 3">H3</button>
          <button class="format-button" id="p-btn" title="Paragraph">P</button>
        </div>
        
        <div class="format-group">
          <button class="format-button" id="ul-btn" title="Bullet List">â€¢ List</button>
          <button class="format-button" id="ol-btn" title="Numbered List">1. List</button>
        </div>
        
        <div class="format-group">
          <button class="format-button" id="code-btn" title="Code">&lt;/&gt;</button>
          <button class="format-button" id="codeblock-btn" title="Code Block">[&lt;/&gt;]</button>
          <button class="format-button" id="quote-btn" title="Blockquote">"</button>
        </div>
        
        <div class="format-group">
          <button class="format-button" id="link-btn" title="Add Link">ðŸ”—</button>
          <button class="format-button" id="hr-btn" title="Horizontal Rule">â€”</button>
        </div>
      </div>
      
      <!-- Resizable Editor Container -->
      <div class="editor-container" id="editor-container">
        <div class="editor-wrapper">
          <!-- TipTap Editor -->
          <div id="editor"></div>
        </div>
        
        <!-- Resize Handle (moved outside wrapper) -->
        <div class="resize-handle" id="resize-handle"></div>
      </div>
    </main>

    <!-- Status Bar -->
    <div class="status-bar">
      <span>Ready</span>
      <span>Line 1, Column 1</span>
    </div>
  </div>

  <!-- PM7 Core JavaScript -->
  <script src="/packages/core/src/scripts/index.js" type="module"></script>

  <script type="module">
    // Initialize editor after modules load
    (async () => {
      // Wait for modules to load
      await new Promise(resolve => setTimeout(resolve, 100));
      
      // Initialize TipTap Editor
      const editor = new window.Editor({
      element: document.querySelector('#editor'),
      extensions: [
        window.StarterKit,
        window.Underline,
        window.TextStyle,
        window.Color,
        window.Link.configure({
          openOnClick: false,
          HTMLAttributes: {
            class: 'tiptap-link',
          },
        }),
      ],
      content: `
        <h1>Welcome to TipTap Editor with PM7 UI!</h1>
        <p>This demo integrates the powerful <strong>TipTap editor</strong> with <em>PM7 UI components</em> for a seamless editing experience.</p>
        
        <h2>Features</h2>
        <ul>
          <li><strong>Rich text formatting</strong> - Bold, italic, underline, and strikethrough</li>
          <li><strong>Headings</strong> - Support for H1, H2, and H3</li>
          <li><strong>Lists</strong> - Both bullet and numbered lists</li>
          <li><strong>Code formatting</strong> - Inline <code>code</code> and code blocks</li>
          <li><strong>Blockquotes</strong> - For highlighting important text</li>
          <li><strong>Links</strong> - Add hyperlinks to your content</li>
        </ul>
        
        <h2>Try it out!</h2>
        <p>Use the menu bar above or the formatting toolbar to style your content. All PM7 UI styles are applied for a consistent look and feel.</p>
        
        <blockquote>
          <p>"The best way to predict the future is to invent it." - Alan Kay</p>
        </blockquote>
        
        <pre><code>// Example code block
function greet(name) {
  console.log(\`Hello, \${name}!\`);
}</code></pre>
      `,
      autofocus: true,
      editorProps: {
        attributes: {
          class: 'tiptap',
        },
      },
    });

    // Update status function
    function updateStatus(message) {
      const statusBar = document.querySelector('.status-bar span');
      statusBar.textContent = message;
      setTimeout(() => {
        statusBar.textContent = 'Ready';
      }, 2000);
    }

    // File menu functions
    window.newFile = function() {
      editor.commands.clearContent();
      updateStatus('New file created');
    };

    window.openFile = function() {
      updateStatus('Open file dialog would appear here...');
    };

    window.saveFile = function() {
      const content = editor.getHTML();
      console.log('Saving content:', content);
      updateStatus('File saved');
    };

    window.exitApp = function() {
      if (confirm('Are you sure you want to exit?')) {
        updateStatus('Exiting application...');
      }
    };

    // Initialize dialog once
    window.aboutDialog = null;
    let aboutBackdrop;
    setTimeout(() => {
      const dialogElement = document.querySelector('#about-dialog [data-pm7-dialog]');
      aboutBackdrop = document.getElementById('about-dialog');
      if (dialogElement) {
        window.aboutDialog = new PM7.Dialog(dialogElement);
        
        // Override open/close to handle backdrop
        const originalOpen = window.aboutDialog.open.bind(window.aboutDialog);
        const originalClose = window.aboutDialog.close.bind(window.aboutDialog);
        
        window.aboutDialog.open = function() {
          aboutBackdrop.setAttribute('data-state', 'open');
          originalOpen();
        };
        
        window.aboutDialog.close = function() {
          aboutBackdrop.removeAttribute('data-state');
          originalClose();
        };
      }
    }, 100);
    
    window.showAbout = function() {
      if (window.aboutDialog) {
        window.aboutDialog.open();
      }
    };

    // Toolbar button handlers
    document.getElementById('bold-btn').onclick = () => editor.chain().focus().toggleBold().run();
    document.getElementById('italic-btn').onclick = () => editor.chain().focus().toggleItalic().run();
    document.getElementById('underline-btn').onclick = () => editor.chain().focus().toggleUnderline().run();
    document.getElementById('strike-btn').onclick = () => editor.chain().focus().toggleStrike().run();
    
    document.getElementById('h1-btn').onclick = () => editor.chain().focus().toggleHeading({ level: 1 }).run();
    document.getElementById('h2-btn').onclick = () => editor.chain().focus().toggleHeading({ level: 2 }).run();
    document.getElementById('h3-btn').onclick = () => editor.chain().focus().toggleHeading({ level: 3 }).run();
    document.getElementById('p-btn').onclick = () => editor.chain().focus().setParagraph().run();
    
    document.getElementById('ul-btn').onclick = () => editor.chain().focus().toggleBulletList().run();
    document.getElementById('ol-btn').onclick = () => editor.chain().focus().toggleOrderedList().run();
    
    document.getElementById('code-btn').onclick = () => editor.chain().focus().toggleCode().run();
    document.getElementById('codeblock-btn').onclick = () => editor.chain().focus().toggleCodeBlock().run();
    document.getElementById('quote-btn').onclick = () => editor.chain().focus().toggleBlockquote().run();
    
    document.getElementById('link-btn').onclick = () => {
      const url = prompt('Enter URL:');
      if (url) {
        editor.chain().focus().setLink({ href: url }).run();
      }
    };
    
    document.getElementById('hr-btn').onclick = () => editor.chain().focus().setHorizontalRule().run();

    // Menu bar handlers
    document.getElementById('undo-btn').onclick = () => {
      editor.chain().focus().undo().run();
      updateStatus('Undo');
    };
    
    document.getElementById('redo-btn').onclick = () => {
      editor.chain().focus().redo().run();
      updateStatus('Redo');
    };
    
    document.getElementById('cut-btn').onclick = () => {
      document.execCommand('cut');
      updateStatus('Cut');
    };
    
    document.getElementById('copy-btn').onclick = () => {
      document.execCommand('copy');
      updateStatus('Copied');
    };
    
    document.getElementById('paste-btn').onclick = () => {
      document.execCommand('paste');
      updateStatus('Pasted');
    };
    
    document.getElementById('select-all-btn').onclick = () => {
      editor.chain().focus().selectAll().run();
      updateStatus('Selected all');
    };

    // Format menu handlers
    document.getElementById('bold-menu').onclick = () => editor.chain().focus().toggleBold().run();
    document.getElementById('italic-menu').onclick = () => editor.chain().focus().toggleItalic().run();
    document.getElementById('underline-menu').onclick = () => editor.chain().focus().toggleUnderline().run();
    document.getElementById('strike-menu').onclick = () => editor.chain().focus().toggleStrike().run();
    document.getElementById('h1-menu').onclick = () => editor.chain().focus().toggleHeading({ level: 1 }).run();
    document.getElementById('h2-menu').onclick = () => editor.chain().focus().toggleHeading({ level: 2 }).run();
    document.getElementById('h3-menu').onclick = () => editor.chain().focus().toggleHeading({ level: 3 }).run();
    document.getElementById('paragraph-menu').onclick = () => editor.chain().focus().setParagraph().run();
    document.getElementById('bullet-list-menu').onclick = () => editor.chain().focus().toggleBulletList().run();
    document.getElementById('ordered-list-menu').onclick = () => editor.chain().focus().toggleOrderedList().run();
    document.getElementById('code-menu').onclick = () => editor.chain().focus().toggleCode().run();
    document.getElementById('code-block-menu').onclick = () => editor.chain().focus().toggleCodeBlock().run();
    document.getElementById('blockquote-menu').onclick = () => editor.chain().focus().toggleBlockquote().run();

    // Show/hide toolbar
    document.getElementById('show-toolbar').onclick = function() {
      const toolbar = document.getElementById('format-toolbar');
      const isChecked = this.dataset.checked === 'true';
      toolbar.style.display = isChecked ? 'flex' : 'none';
    };

    // Update button states based on editor state
    editor.on('selectionUpdate', () => {
      // Toolbar buttons
      document.getElementById('bold-btn').classList.toggle('is-active', editor.isActive('bold'));
      document.getElementById('italic-btn').classList.toggle('is-active', editor.isActive('italic'));
      document.getElementById('underline-btn').classList.toggle('is-active', editor.isActive('underline'));
      document.getElementById('strike-btn').classList.toggle('is-active', editor.isActive('strike'));
      document.getElementById('h1-btn').classList.toggle('is-active', editor.isActive('heading', { level: 1 }));
      document.getElementById('h2-btn').classList.toggle('is-active', editor.isActive('heading', { level: 2 }));
      document.getElementById('h3-btn').classList.toggle('is-active', editor.isActive('heading', { level: 3 }));
      document.getElementById('p-btn').classList.toggle('is-active', editor.isActive('paragraph'));
      document.getElementById('ul-btn').classList.toggle('is-active', editor.isActive('bulletList'));
      document.getElementById('ol-btn').classList.toggle('is-active', editor.isActive('orderedList'));
      document.getElementById('code-btn').classList.toggle('is-active', editor.isActive('code'));
      document.getElementById('codeblock-btn').classList.toggle('is-active', editor.isActive('codeBlock'));
      document.getElementById('quote-btn').classList.toggle('is-active', editor.isActive('blockquote'));
    });

    // Dark mode support
    const darkModeEnabled = window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (darkModeEnabled) {
      document.documentElement.classList.add('dark');
    }

    // Handle theme switching
    document.querySelectorAll('[data-name="theme"]').forEach(btn => {
      btn.addEventListener('click', () => {
        const isDark = btn.dataset.value === 'dark';
        document.documentElement.classList.toggle('dark', isDark);
      });
    });

    // Update cursor position
    editor.on('selectionUpdate', () => {
      // This is a simplified version - real implementation would calculate actual line/column
      const { from } = editor.state.selection;
      const text = editor.state.doc.textContent;
      const lines = text.substring(0, from).split('\n');
      const line = lines.length;
      const col = lines[lines.length - 1].length + 1;
      document.querySelector('.status-bar span:last-child').textContent = `Line ${line}, Column ${col}`;
    });

    // Resize functionality
    const resizeHandle = document.getElementById('resize-handle');
    const editorContainer = document.getElementById('editor-container');
    const editorWrapper = editorContainer.querySelector('.editor-wrapper');
    let isResizing = false;
    let startX;
    let startWidth;
    
    // Position handle next to wrapper
    function positionHandle() {
      const wrapperRect = editorWrapper.getBoundingClientRect();
      const containerRect = editorContainer.getBoundingClientRect();
      const rightEdge = wrapperRect.right - containerRect.left + 8;
      resizeHandle.style.left = rightEdge + 'px';
      resizeHandle.style.height = wrapperRect.height + 'px';
    }
    
    // Initial positioning after a short delay to ensure DOM is ready
    setTimeout(positionHandle, 100);
    window.addEventListener('resize', positionHandle);
    
    // Also reposition when editor content changes
    editor.on('update', () => {
      setTimeout(positionHandle, 50);
    });

    resizeHandle.addEventListener('mousedown', (e) => {
      isResizing = true;
      startX = e.pageX;
      startWidth = editorWrapper.offsetWidth;
      resizeHandle.classList.add('resizing');
      document.body.style.cursor = 'ew-resize';
      e.preventDefault();
    });

    document.addEventListener('mousemove', (e) => {
      if (!isResizing) return;
      
      const containerRect = editorContainer.getBoundingClientRect();
      const wrapperRect = editorWrapper.getBoundingClientRect();
      
      // Calculate new width based on mouse position
      const newWidth = (e.pageX - containerRect.left) - (wrapperRect.left - containerRect.left) - 8;
      
      // Set minimum width only (no maximum)
      const minWidth = 400;
      
      if (newWidth >= minWidth) {
        editorWrapper.style.width = newWidth + 'px';
        // Update handle position directly during drag
        resizeHandle.style.left = (e.pageX - containerRect.left) + 'px';
      }
    });

    document.addEventListener('mouseup', () => {
      if (isResizing) {
        isResizing = false;
        resizeHandle.classList.remove('resizing');
        document.body.style.cursor = '';
        // Reposition handle properly after resize
        positionHandle();
      }
    });

    // Touch support for mobile
    resizeHandle.addEventListener('touchstart', (e) => {
      isResizing = true;
      startX = e.touches[0].pageX;
      startWidth = editorWrapper.offsetWidth;
      resizeHandle.classList.add('resizing');
      e.preventDefault();
    });

    document.addEventListener('touchmove', (e) => {
      if (!isResizing) return;
      
      const containerRect = editorContainer.getBoundingClientRect();
      const wrapperRect = editorWrapper.getBoundingClientRect();
      
      // Calculate new width based on touch position
      const newWidth = (e.touches[0].pageX - containerRect.left) - (wrapperRect.left - containerRect.left) - 8;
      
      // Set minimum width only (no maximum)
      const minWidth = 400;
      
      if (newWidth >= minWidth) {
        editorWrapper.style.width = newWidth + 'px';
        // Update handle position directly during drag
        resizeHandle.style.left = (e.touches[0].pageX - containerRect.left) + 'px';
      }
    });

    document.addEventListener('touchend', () => {
      if (isResizing) {
        isResizing = false;
        resizeHandle.classList.remove('resizing');
        // Reposition handle properly after resize
        positionHandle();
      }
    });
    })(); // End of async initialization
  </script>

  <!-- About Dialog -->
  <div class="pm7-dialog-backdrop" id="about-dialog">
    <div class="pm7-dialog" data-pm7-dialog>
    <div class="pm7-dialog-content">
      <div class="pm7-dialog-header">
        <h2 class="pm7-dialog-title">About TipTap Editor with PM7 UI</h2>
        <button class="pm7-dialog-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="pm7-dialog-body">
        <div style="text-align: center; margin-bottom: 2rem;">
          <div style="width: 80px; height: 80px; background: var(--pm7-primary); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="white">
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
            </svg>
          </div>
          <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Version 2.0.0</h3>
          <p style="color: var(--pm7-muted-foreground);">A powerful rich text editor integration</p>
        </div>

        <div class="pm7-card" style="background: var(--pm7-muted); padding: 1.5rem; margin-bottom: 1.5rem;">
          <h4 style="margin-bottom: 1rem;">What's Included</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div>
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                <div style="width: 8px; height: 8px; background: var(--pm7-primary); border-radius: 50%;"></div>
                <strong>TipTap Editor</strong>
              </div>
              <p style="font-size: 0.875rem; color: var(--pm7-muted-foreground); margin-left: 1rem;">
                Advanced rich text editing with full keyboard support
              </p>
            </div>
            <div>
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                <div style="width: 8px; height: 8px; background: var(--pm7-primary); border-radius: 50%;"></div>
                <strong>PM7 UI Components</strong>
              </div>
              <p style="font-size: 0.875rem; color: var(--pm7-muted-foreground); margin-left: 1rem;">
                Beautiful, accessible UI components
              </p>
            </div>
          </div>
        </div>

        <div style="margin-bottom: 1.5rem;">
          <h4 style="margin-bottom: 1rem;">Key Features</h4>
          <ul style="list-style: none; padding: 0;">
            <li style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--pm7-primary)" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span>Resizable editor with smooth drag handle</span>
            </li>
            <li style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--pm7-primary)" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span>Traditional desktop-style menu bar</span>
            </li>
            <li style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--pm7-primary)" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span>Rich text formatting toolbar</span>
            </li>
            <li style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--pm7-primary)" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span>Dark mode support</span>
            </li>
          </ul>
        </div>

        <div style="padding: 1rem; background: var(--pm7-card); border: 1px solid var(--pm7-border); border-radius: var(--pm7-radius); text-align: center;">
          <p style="margin-bottom: 0.5rem; color: var(--pm7-muted-foreground); font-size: 0.875rem;">Built with</p>
          <div style="display: flex; gap: 1rem; justify-content: center; align-items: center;">
            <a href="https://tiptap.dev" target="_blank" style="color: var(--pm7-primary); text-decoration: none; font-weight: 500;">TipTap</a>
            <span style="color: var(--pm7-muted-foreground);">â€¢</span>
            <a href="https://pm7-ui.com" target="_blank" style="color: var(--pm7-primary); text-decoration: none; font-weight: 500;">PM7 UI</a>
          </div>
        </div>
      </div>
      <div class="pm7-dialog-footer">
        <button class="pm7-button pm7-button--primary" onclick="if(window.aboutDialog) aboutDialog.close()">
          Got it!
        </button>
      </div>
    </div>
  </div>
  </div>
</body>
</html>